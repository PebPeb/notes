
# Petalinux

## Setting up Petalinux in Ubuntu 18.04.4 VM

``` bash
sudo apt install gawk
sudo apt-get install net-tools xterm autoconf libtool texinfo zlib1g-dev gcc-multilib build-essential libncurses5-dev zlib1g:i386
./petalinux-v2022.1-04191534-installer.run
sudo dpkg-reconfigure dash                                        # Select NO
```

...

## Using Petalinux 

Default username: petalinux

## Petalinux Commands

In total there are only 6 petalinux commands.

``` bash
petalinux-create
petalinux-config
petalinux-build
petalinux-boot
petalinux-package
petalinux-util
```

### Build Commands Example

``` bash
petalinux-create -t project -n <prj_name> --template zynq          # Starting petalinux project for Zynq
petalinux-config --get-hw-description=<.xsa>                       # Hardware description file generated by Vivado
petalinux-config -c kernel                                         # ¯\_(ツ)_/¯
petalinux-config -c rootfs
petalinux-build                                                    # Building project
petalinux-package --boot --fsbl zynq_fsbl.elf --u-boot --fpga system.bit --force
petalinux-boot --qemu --kernel
```

``` bash
petalinux-create -t modules \--name mymodule \--enable
petalinux-build -c mymodule
petalinux-build -c mymodule -x do_clean                               # For compiling .ko
petalinux-package --bsp -p . -o <output.bsp> --hwsource <hw.xsa>
```
./build/tmp/sysroots-components/zynq_generic/mymodule/lib/modules/5.15.19-xilinx-v2022.1/extra/mymodule.ko

## Helpful commands 

``` bash
lsblk                                        # Shows add drives in linux
lsblk -f                                     # Includes formating
mount <drive> <folder>
mount -t <format> <drive> <folder>
  vfat                                       # fat32
  ext4                                       # ext4
tar -xzvf <.tar.gz> -C <folder>              # Untars the .tar.gz into <folder>

ifconfig eth0 <ip> netmask <netmask>
```

## Boot SD Card

(partion names don't matter)

Disk
.
+-- _ROOT(fat32)
|   +-- BOOT.BIN
|   +-- boot.src
|   +-- image.ub
+-- _LINUX(ext4)
|   +-- <extracted rootfs.tar.gz>




## Directory Documentation

Petalinux Project
.
+-- build
+-- components
+-- images
+-- project-specs
+-- config.project

### build 

build
.
+-- bitbake-cookerdaemon.log
+-- build.log
+-- build.log.old
+-- cache
+-- conf
+-- config.log
+-- config.log.old
+-- downloads
+-- misc
+-- package.log
+-- package.log.old
+-- sstate-cache
+-- tmp


#### tmp

The `temp` folder is used for holding the files generated by Yocto. In that folder there is a `work` and `work-shared` both of these folders hold the kernel for the system. The `work-shared` folder holds the generic kernel files used by most of all system. Where as the `work` folder holds the specific files of the kernel for the system. There for majority of the kernel is in the `work-shared` with a small amount in the `work`.
